name: Sync GitHub Labels ðŸ”„

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

permissions:
  contents: read

on:
  workflow_dispatch:
  push:
    branches: [main]

jobs:
  labeler:
    runs-on: ubuntu-latest
    timeout-minutes: 6
    permissions:
      contents: read
      issues: write
    steps:
      - name: Checkout
        uses: actions/checkout@v6

      - name: Sync labels to all org repos
        env:
          GH_TOKEN: ${{ secrets.PERSONAL_GITHUB_TOKEN }}
        run: |
          repos=$(gh repo list ChecKMarKDevTools --limit 1000 --json nameWithOwner --jq '.[].nameWithOwner')
          
          for repo in $repos; do
            echo "Syncing labels to $repo"
            jq -c '.[]' .github/org-labels.json | while read -r label; do
              name=$(echo "$label" | jq -r .name)
              color=$(echo "$label" | jq -r .color)
              desc=$(echo "$label" | jq -r .description)
              gh label create "$name" --color "$color" --description "$desc" --repo "$repo" --force
            done
          done
